# VideoPlayer Integration Configuration
# Version: 2.0
# Last Updated: September 2025
# Purpose: Document all external dependencies and system integrations

# ============================================================================
# SYSTEM FRAMEWORKS
# ============================================================================

frameworks:
  apple:
    required:
      - name: SwiftUI
        version: "5.0+"
        usage: "Core UI framework"
        platforms: [iOS, tvOS, macOS]
      
      - name: AVFoundation
        version: "iOS 17.0+"
        usage: "Video playback, metadata extraction"
        platforms: [iOS, tvOS, macOS]
        classes:
          - AVPlayer
          - AVAsset
          - AVAssetImageGenerator
          - AVPlayerItem
      
      - name: AVKit
        version: "iOS 17.0+"
        usage: "VideoPlayer view component"
        platforms: [iOS, tvOS, macOS]
        components:
          - VideoPlayer
      
      - name: Foundation
        version: "iOS 17.0+"
        usage: "File operations, URL handling"
        platforms: [iOS, tvOS, macOS]
        key_apis:
          - FileManager
          - URL
          - URLResourceKey
          - NSFileCoordinator
      
      - name: UniformTypeIdentifiers
        version: "iOS 14.0+"
        usage: "File type validation"
        platforms: [iOS, tvOS, macOS]
        types:
          - UTType.mpeg4Movie
          - UTType.folder
          - UTType.item
      
      - name: SwiftData
        version: "iOS 17.0+"
        usage: "Legacy persistence (to be removed)"
        platforms: [iOS, tvOS, macOS]
        status: "DEPRECATED - Remove in v3.0"
        current_usage:
          - VPVideo model
          - @Query in MoviesView/ShowsView
          - Poster URL generation
    
    platform_specific:
      iOS:
        - name: UIKit
          usage: "Document picker, haptics"
          components:
            - UIDocumentPickerViewController
            - UIImpactFeedbackGenerator
            - UIPasteboard
        
        - name: MobileCoreServices
          usage: "UTI support"
          status: "Legacy, use UniformTypeIdentifiers"
      
      macOS:
        - name: AppKit
          usage: "Native macOS features"
          components:
            - NSWorkspace
            - NSPasteboard
            - NSAppleScript
            - NSCursor
            - NSColor
      
      tvOS:
        - name: TVUIKit
          usage: "Focus engine"
          components:
            - Focus system
            - Remote control handling

# ============================================================================
# FILE SYSTEM INTEGRATION
# ============================================================================

filesystem:
  operations:
    - name: "FileManager"
      methods:
        - contentsOfDirectory(at:includingPropertiesForKeys:options:)
        - createDirectory(at:withIntermediateDirectories:attributes:)
        - removeItem(at:)
        - moveItem(at:to:)
        - copyItem(at:to:)
        - fileExists(atPath:)
      
    - name: "URL"
      methods:
        - startAccessingSecurityScopedResource()
        - stopAccessingSecurityScopedResource()
        - bookmarkData(options:includingResourceValuesForKeys:relativeTo:)
        - resourceValues(forKeys:)
  
  security:
    iOS:
      required_capabilities:
        - security_scoped_bookmarks
        - document_picker_access
        - files_app_visibility
      
      bookmark_storage:
        location: UserDefaults
        format: Data
        keys: "bookmark_[folderName]"
    
    macOS:
      sandbox_entitlements:
        - com.apple.security.files.user-selected.read-only
        - com.apple.security.app-sandbox
    
    tvOS:
      limitations:
        - sandbox_only
        - no_external_storage
        - no_document_picker

  directories:
    structure:
      Documents/:
        VideoPlayer/:
          Movies/:
            description: "Movie files (.m4v)"
            auto_created: true
          TV Shows/:
            description: "TV show files (.m4v)"
            auto_created: true
    
    application_support:
      "[BundleID]/":
        Posters/:
          description: "Cached poster images"
          format: "JPEG"
          naming: "[videoID].jpg"
        VideoLibrary/:
          description: "Legacy imported videos"
          status: "DEPRECATED"

# ============================================================================
# MEDIA HANDLING
# ============================================================================

media:
  supported_formats:
    video:
      - extension: .m4v
        uti: public.mpeg-4
        mime: video/x-m4v
        required: true
        exclusive: true
  
  metadata_extraction:
    AVAsset_properties:
      - duration
      - tracks
      - naturalSize
      - preferredTransform
      - metadata
    
    poster_generation:
      time_offset: "10% of duration"
      max_size: {width: 1200, height: 1800}
      format: JPEG
      quality: 0.85
      blocking: true  # TODO: Make async
  
  playback:
    engine: AVPlayer
    features:
      - play/pause
      - seek
      - volume
      - currentTime
    limitations:
      - no_pip
      - no_airplay
      - no_subtitles
      - no_chapters

# ============================================================================
# USER INTERFACE INTEGRATION
# ============================================================================

ui_integration:
  navigation:
    iOS:
      type: NavigationSplitView
      column_width: {min: 200, ideal: 240, max: 300}
      presentations:
        - sheet
        - fullScreenCover
    
    tvOS:
      type: NavigationStack
      focus: FocusState
      remote_control: true
    
    macOS:
      type: NavigationSplitView
      window_style: native
      fullscreen: toggleFullScreen
  
  materials:
    glass_design:
      - .regularMaterial
      - .ultraThinMaterial
      - .thinMaterial
      - .thickMaterial
    
    blur_effects:
      radius: [20, 30, 40, 50]
      vibrancy: true
  
  animations:
    spring:
      response: 0.35
      damping: 0.8
    
    easeInOut:
      duration: 0.25
    
    fade:
      duration: 0.25

# ============================================================================
# PLATFORM INTEGRATION
# ============================================================================

platform_integration:
  info_plist:
    required_keys:
      iOS:
        - key: UIFileSharingEnabled
          value: true
          reason: "Files app visibility"
        
        - key: LSSupportsOpeningDocumentsInPlace
          value: true
          reason: "Direct file access"
        
        - key: UISupportsDocumentBrowser
          value: true
          reason: "Document browser support"
      
      macOS:
        - key: LSMinimumSystemVersion
          value: "$(MACOSX_DEPLOYMENT_TARGET)"
    
    document_types:
      - name: "MPEG-4 Video"
        role: Viewer
        types: [public.mpeg-4]
        extensions: [m4v]
  
  entitlements:
    all_platforms:
      - com.apple.security.app-sandbox: true
      - com.apple.security.files.user-selected.read-only: true
    
    macOS:
      - com.apple.security.files.downloads.read-only: false
      - com.apple.security.assets.movies.read-only: false

# ============================================================================
# EXTERNAL DEPENDENCIES
# ============================================================================

dependencies:
  swift_packages: []  # No external packages
  
  cocoapods: []  # Not using CocoaPods
  
  system_binaries: []  # No external binaries

# ============================================================================
# BUILD CONFIGURATION
# ============================================================================

build:
  minimum_deployment:
    iOS: "17.0"
    tvOS: "17.0"
    macOS: "14.0"
  
  swift_version: "5.9"
  
  xcode_version: "15.0+"
  
  compiler_flags:
    release:
      - -O  # Optimization
      - -whole-module-optimization
    
    debug:
      - -Onone
      - -D DEBUG
  
  linker_flags: []
  
  strip_symbols: true

# ============================================================================
# TESTING INTEGRATION
# ============================================================================

testing:
  frameworks:
    - XCTest
    - XCUITest
  
  coverage_targets:
    - Core/
    - Inspector/
    - Services/
  
  mock_requirements:
    - FileManager operations
    - Security-scoped resources
    - AVPlayer states
  
  ui_test_requirements:
    - Document picker interaction
    - Focus navigation (tvOS)
    - Keyboard shortcuts (future)

# ============================================================================
# PERFORMANCE MONITORING
# ============================================================================

performance:
  instruments:
    - Time Profiler
    - Allocations
    - System Trace
    - File Activity
  
  metrics:
    - app_launch_time: "<1s"
    - directory_enumeration: "<100ms for 1000 files"
    - poster_generation: "TODO: Make async"
    - memory_baseline: "<50MB"
  
  bottlenecks:
    - poster_generation_blocks_ui
    - synchronous_file_operations
    - swiftdata_queries_unnecessary

# ============================================================================
# DEPRECATION TIMELINE
# ============================================================================

deprecation:
  v2.1:
    - component: ImportView
      action: "Rename to BookmarkView"
      reason: "Misleading name"
    
    - component: VideoImportService.importFile
      action: "Remove import functionality"
      reason: "No longer copying files"
  
  v3.0:
    - component: SwiftData
      action: "Complete removal"
      reason: "Filesystem-only approach"
      affects:
        - VPVideo model
        - @Query in views
        - ModelContainer setup
    
    - component: VideoImportService
      action: "Complete removal"
      reason: "No longer needed"
  
  v4.0:
    - component: Legacy poster system
      action: "Replace with async cache"
      reason: "Performance improvement"

# ============================================================================
# INTEGRATION ISSUES
# ============================================================================

known_issues:
  - issue: "SwiftData queries still active"
    severity: medium
    impact: "Unnecessary overhead"
    resolution: "Remove in v3.0"
  
  - issue: "Poster generation synchronous"
    severity: high
    impact: "UI blocking"
    resolution: "Make async with Task"
  
  - issue: "No file watching"
    severity: low
    impact: "Manual refresh needed"
    resolution: "Add FSEvents/NSFilePresenter"
  
  - issue: "ImportView misnamed"
    severity: medium
    impact: "User confusion"
    resolution: "Rename in v2.1"

# ============================================================================
# FUTURE INTEGRATIONS
# ============================================================================

future:
  planned:
    - name: "CloudKit"
      purpose: "Sync bookmarks across devices"
      timeline: "v3.0"
    
    - name: "Quick Look"
      purpose: "Preview without playback"
      timeline: "v2.5"
    
    - name: "Shortcuts"
      purpose: "Automation support"
      timeline: "v3.5"
  
  considered:
    - name: "Metal"
      purpose: "Custom video effects"
      timeline: "Unknown"
    
    - name: "Network.framework"
      purpose: "SMB/streaming support"
      timeline: "v4.0"